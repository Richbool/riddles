<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>趣味灯谜</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">🎏 趣味灯谜系统</h1>
        
        <!-- 添加灯谜板块 -->
        <div class="card shadow mb-4">
            <div class="card-body">
                <h3 class="card-title mb-3">➕ 添加新灯谜</h3>
                <div class="mb-3">
                    <input type="text" id="inputQuestion" class="form-control" placeholder="输入谜题（例如：小时胖乎乎，老来皮肉皱）">
                </div>
                <div class="mb-3">
                    <input type="text" id="inputAnswer" class="form-control" placeholder="输入答案（例如：核桃）">
                </div>
                <button class="btn btn-success w-100" onclick="addRiddle()">提交灯谜</button>
            </div>
        </div>

        <!-- 猜灯谜板块 -->
        <div class="card shadow">
            <div class="card-body">
                <h3 class="card-title mb-3">🔍 猜灯谜</h3>
                <button class="btn btn-primary w-100 mb-3" onclick="getRiddle()">随机抽取灯谜</button>
                <div id="riddleResult" class="text-center"></div>
            </div>
        </div>

        <!-- 状态栏 -->
        <div class="mt-3 text-muted text-center">
            当前题库数量：<span id="riddleCount">0</span> 条
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.3.6/axios.min.js"></script>
    <script>
        // 初始化加载题库数量
        updateCount()

        // 添加灯谜
        async function addRiddle() {
            const question = document.getElementById('inputQuestion').value
            const answer = document.getElementById('inputAnswer').value

            if (!question || !answer) {
                alert('请填写完整的谜题和答案')
                return
            }

            try {
                const response = await axios.post('/api/riddles', {
                    question: question,
                    answer: answer
                })
                alert('添加成功！当前题库共有 ' + response.data.count + ' 条灯谜')
                updateCount()
                clearInputs()
            } catch (error) {
                alert('添加失败：' + error.response.data.error)
            }
        }

        // 获取随机灯谜
        async function getRiddle() {
            try {
                const response = await axios.get('/api/riddles')
                const answer = prompt('谜题：' + response.data.question + '\n请输入答案：')
                
                if (answer !== null) {
                    const check = await axios.post('/api/check', {
                        question: response.data.question,
                        answer: answer
                    })
                    
                    const resultDiv = document.getElementById('riddleResult')
                    if (check.data.correct) {
                        resultDiv.innerHTML = `
                            <div class="alert alert-success">
                                ✅ 答对了！真厉害！
                            </div>
                        `
                    } else {
                        resultDiv.innerHTML = `
                            <div class="alert alert-danger">
                                ❌ 正确答案是：${check.data.answer}
                            </div>
                        `
                    }
                }
            } catch (error) {
                alert(error.response.data.error)
            }
        }

        // 更新题库数量
        async function updateCount() {
            const response = await axios.get('/')
            document.getElementById('riddleCount').textContent = response.data.count
        }

        // 清空输入框
        function clearInputs() {
            document.getElementById('inputQuestion').value = ''
            document.getElementById('inputAnswer').value = ''
        }
    </script>
</body>
</html>