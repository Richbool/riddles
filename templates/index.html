<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶£å‘³ç¯è°œ</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">ğŸ è¶£å‘³ç¯è°œç³»ç»Ÿ</h1>
        
        <!-- æ·»åŠ ç¯è°œæ¿å— -->
        <div class="card shadow mb-4">
            <div class="card-body">
                <h3 class="card-title mb-3">â• æ·»åŠ æ–°ç¯è°œ</h3>
                <div class="mb-3">
                    <input type="text" id="inputQuestion" class="form-control" placeholder="è¾“å…¥è°œé¢˜ï¼ˆä¾‹å¦‚ï¼šå°æ—¶èƒ–ä¹ä¹ï¼Œè€æ¥çš®è‚‰çš±ï¼‰">
                </div>
                <div class="mb-3">
                    <input type="text" id="inputAnswer" class="form-control" placeholder="è¾“å…¥ç­”æ¡ˆï¼ˆä¾‹å¦‚ï¼šæ ¸æ¡ƒï¼‰">
                </div>
                <button class="btn btn-success w-100" onclick="addRiddle()">æäº¤ç¯è°œ</button>
            </div>
        </div>

        <!-- çŒœç¯è°œæ¿å— -->
        <div class="card shadow">
            <div class="card-body">
                <h3 class="card-title mb-3">ğŸ” çŒœç¯è°œ</h3>
                <button class="btn btn-primary w-100 mb-3" onclick="getRiddle()">éšæœºæŠ½å–ç¯è°œ</button>
                <div id="riddleResult" class="text-center"></div>
            </div>
        </div>

        <!-- çŠ¶æ€æ  -->
        <div class="mt-3 text-muted text-center">
            å½“å‰é¢˜åº“æ•°é‡ï¼š<span id="riddleCount">0</span> æ¡
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.3.6/axios.min.js"></script>
    <script>
        // åˆå§‹åŒ–åŠ è½½é¢˜åº“æ•°é‡
        updateCount()

        // æ·»åŠ ç¯è°œ
        async function addRiddle() {
            const question = document.getElementById('inputQuestion').value
            const answer = document.getElementById('inputAnswer').value

            if (!question || !answer) {
                alert('è¯·å¡«å†™å®Œæ•´çš„è°œé¢˜å’Œç­”æ¡ˆ')
                return
            }

            try {
                const response = await axios.post('/api/riddles', {
                    question: question,
                    answer: answer
                })
                alert('æ·»åŠ æˆåŠŸï¼å½“å‰é¢˜åº“å…±æœ‰ ' + response.data.count + ' æ¡ç¯è°œ')
                updateCount()
                clearInputs()
            } catch (error) {
                alert('æ·»åŠ å¤±è´¥ï¼š' + error.response.data.error)
            }
        }

        // è·å–éšæœºç¯è°œ
        async function getRiddle() {
            try {
                const response = await axios.get('/api/riddles')
                const answer = prompt('è°œé¢˜ï¼š' + response.data.question + '\nè¯·è¾“å…¥ç­”æ¡ˆï¼š')
                
                if (answer !== null) {
                    const check = await axios.post('/api/check', {
                        question: response.data.question,
                        answer: answer
                    })
                    
                    const resultDiv = document.getElementById('riddleResult')
                    if (check.data.correct) {
                        resultDiv.innerHTML = `
                            <div class="alert alert-success">
                                âœ… ç­”å¯¹äº†ï¼çœŸå‰å®³ï¼
                            </div>
                        `
                    } else {
                        resultDiv.innerHTML = `
                            <div class="alert alert-danger">
                                âŒ æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${check.data.answer}
                            </div>
                        `
                    }
                }
            } catch (error) {
                alert(error.response.data.error)
            }
        }

        // æ›´æ–°é¢˜åº“æ•°é‡
        async function updateCount() {
            const response = await axios.get('/')
            document.getElementById('riddleCount').textContent = response.data.count
        }

        // æ¸…ç©ºè¾“å…¥æ¡†
        function clearInputs() {
            document.getElementById('inputQuestion').value = ''
            document.getElementById('inputAnswer').value = ''
        }
    </script>
</body>
</html>