<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…ƒå®µç¯è°œä¼š | xrq-rich.com</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>ğŸ® å…ƒå®µç¯è°œä¼š ğŸ‰</h1>
        
        <main class="game-container">
            {% if riddle_text %}
            <div class="riddle-box">
                <div class="riddle-card">
                    <p class="riddle-text">{{ riddle_text }}</p>
                    <form onsubmit="return submitAnswer(this)">
                        <input type="text" id="answerInput" 
                               placeholder="è¾“å…¥ç­”æ¡ˆ..." 
                               autocomplete="off">
                        <button type="submit">æäº¤ç­”æ¡ˆ</button>
                    </form>
                </div>
            </div>
            {% else %}
            <div class="start-box">
                <button class="start-btn" onclick="startGame()">
                    ç‚¹å‡»å¼€å§‹çŒœè°œ
                </button>
            </div>
            {% endif %}

            {% if result %}
            <div class="result-box {{ 'correct' if result.is_correct else 'wrong' }}">
                {% if result.is_correct %}
                <div class="result-success">
                    <p>ğŸ‰ å›ç­”æ­£ç¡®ï¼</p>
                    <button onclick="startGame()">ç»§ç»­æŒ‘æˆ˜</button>
                </div>
                {% else %}
                <div class="result-fail">
                    <div class="user-answer-section">
                        <p>âŒ ä½ çš„ç­”æ¡ˆï¼š{{ result.user_answer }}</p>
                        <p>âœ… æ­£ç¡®ç­”æ¡ˆï¼š{{ result.correct_answer }}</p>
                    </div>
                    <button class="next-btn" onclick="nextRiddle()">ä¸‹ä¸€é¢˜ â”</button>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </main>
    </div>

    <!-- ä¿®å¤åçš„JavaScriptä»£ç  -->
    <script>
        function startGame() {
            window.location.href = "/start";
        }

        // ä¼˜åŒ–åçš„ç­”æ¡ˆæäº¤å‡½æ•°
        function submitAnswer(form) {
            const answerInput = document.getElementById('answerInput');
            const rawAnswer = answerInput.value.trim();
            
            if (!rawAnswer) {
                alert('è¯·è¾“å…¥ç­”æ¡ˆ');
                return false;
            }

            // åŒé‡ç¼–ç å¤„ç†ç‰¹æ®Šå­—ç¬¦
            const encodedAnswer = encodeURIComponent(encodeURIComponent(rawAnswer));
            window.location.href = `/check/${encodedAnswer}`;
            return false;
        }

        function nextRiddle() {
            window.location.href = "/next";
        }

        // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
        window.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('answerInput');
            input && input.focus();
        });
    </script>
</body>
</html>
